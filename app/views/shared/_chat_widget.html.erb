<% support_agent = Conversation.support_agent %>
<% conversation = Conversation.support_conversation_for(current_user) if support_agent %>

<% return unless support_agent %>

<div class="fixed bottom-6 right-6 z-50">
  <div data-controller="chat-widget" class="relative">
    <%= turbo_stream_from [current_user, :support_chat] %>
    <div id="chat_widget_toggle">
      <%= render "shared/chat_widget_toggle", conversation: conversation, viewer: current_user %>
    </div>
    <div data-chat-widget-target="panel" class="pointer-events-none absolute bottom-16 right-0 z-50 w-[400px] max-w-[calc(100vw-3rem)] translate-x-full transform opacity-0 transition duration-300 ease-out">
      <turbo-frame id="support_chat_panel" data-chat-widget-target="frame" data-chat-widget-src="<%= support_chat_path %>" class="block h-[600px] max-h-[calc(100vh-7rem)] w-full">
        <div class="flex h-full items-center justify-center rounded-3xl bg-white text-sm font-medium text-gray-500 shadow-xl ring-1 ring-gray-200">
          Connecting to supportâ€¦
        </div>
      </turbo-frame>
    </div>
  </div>
</div>
