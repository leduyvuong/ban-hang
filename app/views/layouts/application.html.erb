<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title><%= page_title %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="<%= page_description %>">
    <link rel="canonical" href="<%= canonical_url %>">
    <% if meta_robots.present? %>
      <meta name="robots" content="<%= meta_robots %>">
    <% end %>
    <% og = open_graph_tags %>
    <meta property="og:type" content="<%= og[:type] %>">
    <meta property="og:title" content="<%= og[:title] %>">
    <meta property="og:description" content="<%= og[:description] %>">
    <meta property="og:url" content="<%= og[:url] %>">
    <% if og[:image].present? %>
      <meta property="og:image" content="<%= og[:image] %>">
    <% end %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= yield :structured_data %>
  </head>
  <body class="min-h-screen bg-gray-50 text-gray-900" data-controller="cart" data-cart-add-url-value="<%= add_item_cart_path %>" data-cart-update-url-value="<%= update_item_cart_path %>" data-cart-remove-url-value="<%= remove_item_cart_path %>" data-cart-clear-url-value="<%= clear_cart_path %>" data-cart-mini-url-value="<%= mini_cart_path(format: :json) %>">
    <header class="bg-white border-b border-gray-200">
      <div class="container mx-auto px-4">
        <nav class="flex flex-wrap items-center justify-between gap-4 py-4 md:flex-nowrap" aria-label="Primary">
          <div class="flex items-center space-x-2">
            <a href="/" class="text-2xl font-semibold text-indigo-600">BanHang</a>
          </div>
          <form action="#" method="get" class="order-3 w-full md:order-none md:flex-1 md:px-8" role="search">
            <div class="relative">
              <label for="global-search" class="sr-only">Search products</label>
              <input id="global-search" type="search" name="q" placeholder="Search products..." class="w-full rounded-full border border-gray-300 bg-gray-100 py-2 pl-4 pr-10 text-sm focus:border-indigo-500 focus:bg-white focus:outline-none">
              <span class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35m0 0a7.5 7.5 0 1 0-10.607-10.607 7.5 7.5 0 0 0 10.608 10.607Z" />
                </svg>
              </span>
            </div>
          </form>
          <div class="flex items-center space-x-4">
            <div data-cart-target="mini">
              <%= render partial: "cart/mini", locals: { cart: current_cart } %>
            </div>
            <% if logged_in? %>
              <details class="group relative">
                <summary class="flex cursor-pointer items-center gap-2 rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:border-indigo-200 hover:text-indigo-600">
                  <span class="hidden sm:inline">Hi, <%= current_user.name.split.first %></span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                  </svg>
                </summary>
                <div class="absolute right-0 z-50 mt-2 w-48 overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-lg">
                  <div class="border-b border-gray-100 px-4 py-3 text-xs text-gray-500">
                    Signed in as <span class="font-semibold text-gray-700"><%= current_user.email %></span>
                  </div>
                  <nav class="px-2 py-2 text-sm text-gray-700">
                    <%= link_to "My orders", orders_path, class: "block rounded-xl px-3 py-2 transition hover:bg-indigo-50 hover:text-indigo-600" %>
                    <%= link_to "Profile", edit_profile_path, class: "block rounded-xl px-3 py-2 transition hover:bg-indigo-50 hover:text-indigo-600" %>
                    <% if admin? %>
                      <%= link_to "Admin dashboard", admin_root_path, class: "block rounded-xl px-3 py-2 transition hover:bg-indigo-50 hover:text-indigo-600" %>
                    <% end %>
                    <%= button_to "Logout", session_path, method: :delete, class: "mt-2 w-full rounded-xl px-3 py-2 text-left text-red-600 transition hover:bg-red-50", form: { class: "px-2 pb-2" } %>
                  </nav>
                </div>
              </details>
            <% else %>
              <div class="flex items-center gap-3">
                <%= link_to "Login", new_session_path, class: "rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 transition hover:border-indigo-200 hover:text-indigo-600" %>
                <%= link_to "Register", new_registration_path, class: "rounded-full bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow transition hover:bg-indigo-500" %>
              </div>
            <% end %>
          </div>
        </nav>
      </div>
    </header>

    <%= render "shared/flash" %>

    <main class="grow">
      <div class="container mx-auto px-4 py-12 sm:py-16">
        <%= yield %>
      </div>
    </main>
    <%= render "shared/footer" %>
    <div data-cart-target="drawer" class="hidden">
      <%= render partial: "cart/drawer", locals: { cart: current_cart } %>
    </div>
    <div class="pointer-events-none fixed top-5 right-5 z-50 space-y-3" data-cart-target="notifications"></div>
  </body>
</html>
