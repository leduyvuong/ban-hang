<div class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">Customers</h1>
      <p class="text-sm text-slate-500">Manage your customer base, review lifetime value, and take action quickly.</p>
    </div>
    <%= form_with url: admin_customers_path, method: :get, local: true, class: "flex flex-wrap items-center gap-2" do |form| %>
      <div class="relative">
        <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-slate-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75 21 21" />
            <circle cx="10.5" cy="10.5" r="7.5" />
          </svg>
        </span>
        <%= form.text_field :query, value: @query, placeholder: "Search by name or email", class: "w-64 rounded-full border border-slate-200 bg-white py-2 pl-9 pr-4 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-100" %>
      </div>

      <%= form.select :status,
            options_for_select([["Any status", ""], ["Active", "active"], ["Blocked", "blocked"]], @status_filter),
            {},
            class: "rounded-full border border-slate-200 bg-white px-4 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-100" %>

      <%= form.submit "Filter", class: "inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-indigo-500" %>
    <% end %>
  </div>

  <% if @customers.any? %>
    <div class="overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-sm">
      <table class="min-w-full divide-y divide-slate-200 text-sm text-slate-600">
        <thead class="bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500">
          <tr>
            <th scope="col" class="px-4 py-3 text-left">Name</th>
            <th scope="col" class="px-4 py-3 text-left">Email</th>
            <th scope="col" class="px-4 py-3 text-left">Phone</th>
            <th scope="col" class="px-4 py-3 text-right">Orders</th>
            <th scope="col" class="px-4 py-3 text-right">Total Spent</th>
            <th scope="col" class="px-4 py-3 text-left">Joined</th>
            <th scope="col" class="px-4 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          <% @customers.each do |customer| %>
            <tr class="hover:bg-indigo-50/40">
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                <div>
                  <p class="font-semibold text-slate-900"><%= customer.name %></p>
                  <% if customer.blocked? %>
                    <span class="mt-1 inline-flex items-center rounded-full bg-red-100 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-red-600">Blocked</span>
                  <% end %>
                </div>
              </div>
            </td>
            <td class="px-4 py-3"><%= mail_to customer.email, customer.email, class: "text-indigo-600 hover:text-indigo-500" %></td>
            <td class="px-4 py-3"><%= customer.phone.presence || "â€”" %></td>
            <td class="px-4 py-3 text-right font-semibold text-slate-900"><%= customer.orders_count %></td>
            <td class="px-4 py-3 text-right font-semibold text-slate-900"><%= format_money(customer.total_spent) %></td>
            <td class="px-4 py-3"><%= customer.created_at.strftime("%b %-d, %Y") %></td>
            <td class="px-4 py-3 text-right">
              <div class="inline-flex items-center gap-2 text-xs font-semibold">
                <%= link_to "View", admin_customer_path(customer), class: "rounded-full border border-slate-200 px-3 py-1 text-slate-600 hover:border-indigo-200 hover:text-indigo-600" %>
                <%= link_to "Edit", edit_admin_customer_path(customer), class: "rounded-full border border-indigo-100 bg-indigo-50 px-3 py-1 text-indigo-700 hover:bg-indigo-100" %>
                <%= link_to(customer.blocked? ? "Unblock" : "Block", block_admin_customer_path(customer), method: :patch, class: "rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-amber-600 hover:bg-amber-100", data: { turbo_confirm: customer.blocked? ? "Unblock #{customer.name}?" : "Block #{customer.name}?" }) %>
                <%= link_to "Delete", admin_customer_path(customer), method: :delete, class: "rounded-full border border-red-200 bg-red-50 px-3 py-1 text-red-600 hover:bg-red-100", data: { turbo_confirm: "Delete #{customer.name}?" } %>
              </div>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="rounded-3xl border border-dashed border-slate-200 bg-white px-6 py-12 text-center text-sm text-slate-500 shadow-sm">
      No customers found.
    </div>
  <% end %>

  <%= render "shared/pagination", pagy: @pagy %>
</div>
